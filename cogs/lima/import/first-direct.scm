(require "lima/types.scm")
(require "lima/list.scm")
(require "lima/import/prelude.scm")
(require "lima/import/types.scm")

(define (convert imported currency base-account other-account)
  (let* ((fields (imported-raw-transaction-fields imported))
         (date-i (list-index fields "date"))
         (description-i (list-index fields "description"))
         (amount-i (list-index fields "amount")))
    (map (lambda (txn)
          (let ((date (parse-date(list-ref txn date-i) "%d/%m/%Y"))
                (description (list-ref txn description-i))
                (amt (parse-decimal (list-ref txn amount-i))))
            (transaction date description "" (amount amt currency) base-account (list other-account))))
      (imported-raw-transactions imported))))

(define converted (reverse (convert *imported* "GBP" "Assets:Bank" "Expenses:Unknown")))
